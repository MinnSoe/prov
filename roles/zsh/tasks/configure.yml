---
- name: Link user provided zsh configuration
  command: 'stow -d {{ zsh_dotfiles_location }} -t {{ zsh_user_home }} zsh'
  when: zsh_should_use_dotfiles

- name: Create .zshrc file if it does not exist
  copy:
    content: ''
    force: false
    dest: '{{ ansible_env.HOME }}/.zshrc'
    owner: '{{ zsh_user }}'
    mode: 0644

- name: Ensure antigen is sourced in .zshrc
  lineinfile:
    path: '{{ ansible_env.HOME }}/.zshrc'
    line: 'source $HOME/{{ zsh_antigen_directory }}/antigen.zsh'

- name: Ensure antigen is applied in .zshrc after configuring
  lineinfile:
    path: '{{ ansible_env.HOME }}/.zshrc'
    insertafter: 'antigen'
    line: 'antigen apply'
